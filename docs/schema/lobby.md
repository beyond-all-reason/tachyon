<!-- THIS FILE IS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT IT MANUALLY -->

# Lobby

# Lobby

A lobby is a place where players can chat and setup a game before going into it.
A player can only be in at most one lobby at a time.


## Updates with JSON patch

For updates, we are using json merge patch [RFC 7386](https://www.rfc-editor.org/rfc/rfc7386.html).
These are used for [lobby/listUpdated](#listUpdated) and [lobby/updated](#updated) events. More
on them below.

An example of json patch:

```json
{
    "teams": {
        "01": {"maxPlayers": 1},
        "02": {"maxPlayers": 2}
    }
}
```
is the representation of
```json
{
    "teams": [{"maxPlayers": 1}, {"maxPlayers": 2}]
}
```

Removing the first team can be represented by the following patch objects (they are equivalent):

```json
{
    "teams": {
        "01": {"maxPlayers": 2},
        "02": null
    }
}

{
    "teams": {
        "01": null
    }
}
```


## Lobby details

[lobby/create](#create) is used to create and join a lobby. When you create a lobby
you also automatically becomes the first player in the first allyTeam.

For other player to join a lobby, they need the lobby ID with [lobby/join](#join),
this operation is idempotent. Attempting to join a different lobby while being
in a lobby will fail with `invalid_request`.

Upon joining, clients receive the full state of the lobby as
response and will automatically get [lobby/updated](#updated) events when
something changes. There is no need to subscribe or unsubscribe to this event,
lobby membership is equivalent to subscription.
This event follow the same json merge patch structure.
As such, arrays like teams are represented using objects, where the items
are ordered based on their keys.

A player can use [lobby/leave](#leave) to leave the lobby, but can also be forcibly removed
from a lobby, in which case they would receive [lobby/left](#left) event. This can
happen when the player is kicked, or if the lobby crashed. In this case, the client should
consider no longer in the lobby. This event is only sent to the player that was removed.
It will not be sent when the client leave using [lobby/leave](#leave).

When a lobby is empty, it is automatically disposed off.


### Lobby members

Joining a lobby puts the user as a spectator.
They can then use [lobby/joinAllyTeam](#joinAllyTeam) to join a specific ally team.
If the target ally team is full, the request fails and nothing happen. `joinAllyTeam` can also be used
to change team. Similarly, if the ally team is full, the request fails and nothing happen.

A member can also choose to join the waiting queue of the lobby with [lobby/joinQueue](#joinQueue). This can be used when all ally teams are full, and/or when the user doesn't care which ally team they should join.
A member in the join queue is represented with `{type: "spec", joinQueuePosition: number()}`. The join queue
positions may not be consecutive. The following is possible:

`members: {
    "123": {"type": "spec", "joinQueuePosition": 3}
    "456": {"type": "spec", "joinQueuePosition": 1}
    "789": {"type": "spec", "joinQueuePosition": 10}
}`

When a suitable ally team has a free spot for a waiting player, the server will automatically put them
in that spot and update its state through [lobby/updated](#updated).
A member simply spectating and not waiting to play will have a null `joinQueuePosition`.
To leave an ally team or the join queue and become a spectator, a user should use [lobby/spectate](#spectate).



## List of all lobbies

Other players can get the list of lobbies through [lobby/subscribeList](#subscribeList). After being
subscribed they receive [lobby/listUpdated](#listUpdated) events.
This allow clients to maintain a list of lobbies on their side.
The event [lobby/listReset](#listReset) holds the full list of lobbies. Upon receiving this
event, a client should set its internal list of lobbies according to this event.
In practice, this event should rarely be seen.

---
- [create](#create)
- [join](#join)
- [joinAllyTeam](#joinallyteam)
- [joinQueue](#joinqueue)
- [leave](#leave)
- [left](#left)
- [listReset](#listreset)
- [listUpdated](#listupdated)
- [spectate](#spectate)
- [startBattle](#startbattle)
- [subscribeList](#subscribelist)
- [unsubscribeList](#unsubscribelist)
- [updateMods](#updatemods)
- [updateSync](#updatesync)
- [updated](#updated)
---

## Create

Create a lobby

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyCreateRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/create" },
        "data": {
            "title": "LobbyCreateRequestData",
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "mapName": { "type": "string" },
                "allyTeamConfig": {
                    "description": "each object describes an ally team",
                    "type": "array",
                    "items": {
                        "description": "config for this ally team",
                        "type": "object",
                        "properties": {
                            "maxTeams": { "type": "integer", "minimum": 1 },
                            "startBox": { "$ref": "#/definitions/startBox" },
                            "teams": {
                                "type": "array",
                                "items": {
                                    "type": "object",
                                    "properties": {
                                        "maxPlayers": {
                                            "type": "integer",
                                            "minimum": 1
                                        }
                                    },
                                    "required": ["maxPlayers"]
                                }
                            }
                        },
                        "required": ["maxTeams", "startBox", "teams"]
                    }
                }
            },
            "required": ["name", "mapName", "allyTeamConfig"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "exercitation",
    "commandId": "lobby/create",
    "data": {
        "name": "fugiat id aute",
        "mapName": "labore consequat tempor adipisicing ullamco",
        "allyTeamConfig": []
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyCreateRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/create";
    data: LobbyCreateRequestData;
}
export interface LobbyCreateRequestData {
    name: string;
    mapName: string;
    allyTeamConfig: {
        maxTeams: number;
        startBox: StartBox;
        teams: {
            maxPlayers: number;
        }[];
    }[];
}
export interface StartBox {
    top: number;
    bottom: number;
    left: number;
    right: number;
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyCreateResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyCreateOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/create" },
                "status": { "const": "success" },
                "data": {
                    "$ref": "#/definitions/lobbyDetails",
                    "title": "LobbyCreateOkResponseData"
                }
            },
            "required": ["type", "messageId", "commandId", "status", "data"]
        },
        {
            "title": "LobbyCreateFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/create" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "in voluptate in",
    "commandId": "lobby/create",
    "status": "success",
    "data": {
        "id": "ut fugiat esse in",
        "bossId": "351",
        "name": "nulla culpa aliquip exercitation",
        "mapName": "in",
        "engineVersion": "laborum est cupidatat",
        "gameVersion": "sunt ut incididunt",
        "allyTeamConfig": {
            "'zA": {
                "startBox": {
                    "top": 0.6702225208282471,
                    "bottom": 0.08513057231903076,
                    "left": 0.6979477405548096,
                    "right": 0.39217686653137207
                },
                "maxTeams": 49125404,
                "teams": {
                    "&Z`y[~1<$\"": {
                        "maxPlayers": 93489022
                    },
                    "YJn&cu:{BT": {
                        "maxPlayers": 94367475
                    },
                    "p>g": {
                        "maxPlayers": 83924681
                    },
                    "bVt55^^F+)": {
                        "maxPlayers": 22539419
                    },
                    ";": {
                        "maxPlayers": 86343200
                    }
                }
            },
            "%}": {
                "startBox": {
                    "top": 0.575905978679657,
                    "bottom": 0.04219859838485718,
                    "left": 0.48406165838241577,
                    "right": 0.6355019807815552
                },
                "maxTeams": 31750095,
                "teams": {
                    "": {
                        "maxPlayers": 58379370
                    },
                    "Di#gQz": {
                        "maxPlayers": 11101032
                    },
                    "sK": {
                        "maxPlayers": 32934458
                    }
                }
            }
        },
        "mods": [
            {
                "name": "tempor",
                "archiveName": "elit dolor dolor ut in",
                "gitRef": "aliquip consequat adipisicing amet qui",
                "repository": "dolor mollit labore",
                "type": "github"
            },
            {
                "name": "Ut mollit sit veniam",
                "archiveName": "do in officia anim tempor",
                "gitRef": "culpa aute adipisicing velit",
                "repository": "dolore minim",
                "type": "github"
            },
            {
                "name": "consequat nisi ullamco mollit",
                "archiveName": "dolore",
                "gitRef": "consectetur elit proident Lorem",
                "repository": "pariatur reprehenderit cillum in",
                "type": "github"
            }
        ],
        "members": {
            "G] d5": {
                "type": "player",
                "allyTeam": "sunt consectetur quis dolore",
                "team": "exercitation",
                "player": "nisi consequat",
                "sync": {
                    "map": false,
                    "engine": false,
                    "game": true,
                    "mods": [
                        "pariatur",
                        "id consequat magna in",
                        "dolore sed et veniam proident",
                        "cillum labore dolor laboris",
                        "labore et ea"
                    ]
                }
            },
            "hO*;8OjE.": {
                "type": "spec",
                "id": "351",
                "joinQueuePosition": -50456011.2953186,
                "sync": {
                    "map": false,
                    "engine": false,
                    "game": false,
                    "mods": [
                        "adipisicing laborum"
                    ]
                }
            }
        },
        "currentBattle": {
            "startedAt": 1705432698000000
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UserId = string;
export type UnixTime = number;

export interface LobbyCreateOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/create";
    status: "success";
    data: LobbyCreateOkResponseData;
}
export interface LobbyCreateOkResponseData {
    id: string;
    bossId: string;
    name: string;
    mapName: string;
    engineVersion: string;
    gameVersion: string;
    allyTeamConfig: {
        [k: string]: {
            startBox: StartBox;
            maxTeams: number;
            teams: {
                [k: string]: {
                    maxPlayers: number;
                };
            };
        };
    };
    mods:
        | []
        | [Mod]
        | [Mod, Mod]
        | [Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod];
    members: {
        [k: string]:
            | {
                  type: "player";
                  id: UserId;
                  allyTeam: string;
                  team: string;
                  player: string;
                  sync?: MemberSyncStatus;
              }
            | {
                  type: "spec";
                  id: UserId;
                  joinQueuePosition?: number;
                  sync?: MemberSyncStatus1;
              };
    };
    currentBattle?: {
        startedAt: UnixTime;
    };
}
export interface StartBox {
    top: number;
    bottom: number;
    left: number;
    right: number;
}
export interface Mod {
    name: string;
    archiveName: string;
    gitRef: string;
    repository: string;
    type: "github";
}
export interface MemberSyncStatus {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
export interface MemberSyncStatus1 {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## Join

Join a lobby. On success, get the lobby state and will receive updated events as long as player is in lobby.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/join" },
        "data": {
            "title": "LobbyJoinRequestData",
            "type": "object",
            "properties": { "id": { "type": "string" } },
            "required": ["id"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "veniam",
    "commandId": "lobby/join",
    "data": {
        "id": "est irure mollit"
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyJoinRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/join";
    data: LobbyJoinRequestData;
}
export interface LobbyJoinRequestData {
    id: string;
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyJoinOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/join" },
                "status": { "const": "success" },
                "data": {
                    "$ref": "#/definitions/lobbyDetails",
                    "title": "LobbyJoinOkResponseData"
                }
            },
            "required": ["type", "messageId", "commandId", "status", "data"]
        },
        {
            "title": "LobbyJoinFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/join" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "lobby_full",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "ea ullamco dolore nostrud in",
    "commandId": "lobby/join",
    "status": "success",
    "data": {
        "id": "officia",
        "bossId": "351",
        "name": "culpa ea cillum sed",
        "mapName": "cupidatat fugiat",
        "engineVersion": "nostrud",
        "gameVersion": "consectetur nulla",
        "allyTeamConfig": {
            "W |:KuOk/x": {
                "startBox": {
                    "top": 0.9852176904678345,
                    "bottom": 0.8239824771881104,
                    "left": 0.1293366551399231,
                    "right": 0.4055666923522949
                },
                "maxTeams": 37898821,
                "teams": {
                    "/#": {
                        "maxPlayers": 10862983
                    },
                    "Tgi:=W1e[l": {
                        "maxPlayers": 89296908
                    },
                    "k": {
                        "maxPlayers": 52734781
                    },
                    ".?P!U,!?5'": {
                        "maxPlayers": 3402854
                    }
                }
            },
            "hoF5u}Kzr": {
                "startBox": {
                    "top": 0.6892774701118469,
                    "bottom": 0.8497186899185181,
                    "left": 0.7103871703147888,
                    "right": 0.9681347608566284
                },
                "maxTeams": 96600134,
                "teams": {
                    ")([kEBk": {
                        "maxPlayers": 71045322
                    },
                    "'o%8'^": {
                        "maxPlayers": 91175366
                    },
                    ".dL{FOk": {
                        "maxPlayers": 73071063
                    },
                    "Ao": {
                        "maxPlayers": 1691151
                    }
                }
            },
            "C": {
                "startBox": {
                    "top": 0.03288298845291138,
                    "bottom": 0.4155328869819641,
                    "left": 0.1541842818260193,
                    "right": 0.964246928691864
                },
                "maxTeams": 61257262,
                "teams": {
                    "": {
                        "maxPlayers": 23848182
                    },
                    "lTI2\\_;`#": {
                        "maxPlayers": 91612584
                    },
                    "Io6": {
                        "maxPlayers": 79138524
                    },
                    "$IZK?A^": {
                        "maxPlayers": 73491222
                    }
                }
            }
        },
        "mods": [],
        "members": {
            "Tz": {
                "type": "player",
                "id": "351",
                "allyTeam": "nisi fugiat eu nostrud anim",
                "team": "proident nostrud ullamco sint",
                "player": "sint",
                "sync": {
                    "map": true,
                    "engine": false,
                    "game": false,
                    "mods": []
                }
            },
            "\\h(!G,Ia8V": {
                "type": "player",
                "id": "351",
                "allyTeam": "tempor",
                "team": "ipsum exercitation aute dolore sed",
                "player": "Duis velit Excepteur",
                "sync": {
                    "map": false,
                    "engine": true,
                    "game": false,
                    "mods": [
                        "et adipisicing dolore dolor",
                        "cillum in anim deserunt",
                        "est",
                        "dolore magna exercitation proident sint"
                    ]
                }
            }
        },
        "currentBattle": {
            "startedAt": 1705432698000000
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UserId = string;
export type UnixTime = number;

export interface LobbyJoinOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/join";
    status: "success";
    data: LobbyJoinOkResponseData;
}
export interface LobbyJoinOkResponseData {
    id: string;
    bossId: string;
    name: string;
    mapName: string;
    engineVersion: string;
    gameVersion: string;
    allyTeamConfig: {
        [k: string]: {
            startBox: StartBox;
            maxTeams: number;
            teams: {
                [k: string]: {
                    maxPlayers: number;
                };
            };
        };
    };
    mods:
        | []
        | [Mod]
        | [Mod, Mod]
        | [Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod];
    members: {
        [k: string]:
            | {
                  type: "player";
                  id: UserId;
                  allyTeam: string;
                  team: string;
                  player: string;
                  sync?: MemberSyncStatus;
              }
            | {
                  type: "spec";
                  id: UserId;
                  joinQueuePosition?: number;
                  sync?: MemberSyncStatus1;
              };
    };
    currentBattle?: {
        startedAt: UnixTime;
    };
}
export interface StartBox {
    top: number;
    bottom: number;
    left: number;
    right: number;
}
export interface Mod {
    name: string;
    archiveName: string;
    gitRef: string;
    repository: string;
    type: "github";
}
export interface MemberSyncStatus {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
export interface MemberSyncStatus1 {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
```
Possible Failed Reasons: `lobby_full`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## JoinAllyTeam

Joins the given ally team in an empty team.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinAllyTeamRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/joinAllyTeam" },
        "data": {
            "title": "LobbyJoinAllyTeamRequestData",
            "type": "object",
            "properties": { "allyTeam": { "type": "string" } },
            "required": ["allyTeam"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "anim deserunt do",
    "commandId": "lobby/joinAllyTeam",
    "data": {
        "allyTeam": "Excepteur est officia"
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyJoinAllyTeamRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/joinAllyTeam";
    data: LobbyJoinAllyTeamRequestData;
}
export interface LobbyJoinAllyTeamRequestData {
    allyTeam: string;
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinAllyTeamResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyJoinAllyTeamOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/joinAllyTeam" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyJoinAllyTeamFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/joinAllyTeam" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "not_in_lobby",
                        "ally_team_full",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "tempor elit eiusmod",
    "commandId": "lobby/joinAllyTeam",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyJoinAllyTeamOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/joinAllyTeam";
    status: "success";
}
```
Possible Failed Reasons: `not_in_lobby`, `ally_team_full`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## JoinQueue

Joins the waiting queue to play. The server will automatically put the user in the first suitable ally team when the time comes.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinQueueRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/joinQueue" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "reprehenderit Duis exercitation id",
    "commandId": "lobby/joinQueue"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyJoinQueueRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/joinQueue";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyJoinQueueResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyJoinQueueOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/joinQueue" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyJoinQueueFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/joinQueue" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "not_in_lobby",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "fugiat quis aliqua",
    "commandId": "lobby/joinQueue",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyJoinQueueOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/joinQueue";
    status: "success";
}
```
Possible Failed Reasons: `not_in_lobby`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## Leave

Leave the lobby, also unsubscribe from any update

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyLeaveRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/leave" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "nisi exercitation",
    "commandId": "lobby/leave"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyLeaveRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/leave";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyLeaveResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyLeaveOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/leave" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyLeaveFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/leave" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "ad amet est",
    "commandId": "lobby/leave",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyLeaveOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/leave";
    status: "success";
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## Left

Sent by the server when the player is removed from the lobby. Can be kicked/ban or the lobby crashed

- Endpoint Type: **Event**
- Source: **Server**
- Target: **User**
- Required Scopes: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyLeftEvent",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "event" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/left" },
        "data": {
            "title": "LobbyLeftEventData",
            "type": "object",
            "properties": {
                "id": { "type": "string" },
                "reason": { "type": "string" }
            },
            "required": ["id", "reason"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "est",
    "commandId": "lobby/left",
    "data": {
        "id": "et pariatur proident",
        "reason": "voluptate quis consectetur"
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyLeftEvent {
    type: "event";
    messageId: string;
    commandId: "lobby/left";
    data: LobbyLeftEventData;
}
export interface LobbyLeftEventData {
    id: string;
    reason: string;
}
```
---

## ListReset

Sent by the server to give the client the full list of all lobbies

- Endpoint Type: **Event**
- Source: **Server**
- Target: **User**
- Required Scopes: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyListResetEvent",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "event" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/listReset" },
        "data": {
            "title": "LobbyListResetEventData",
            "type": "object",
            "properties": {
                "lobbies": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": { "$ref": "#/definitions/lobbyOverview" }
                    }
                }
            },
            "required": ["lobbies"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "sint",
    "commandId": "lobby/listReset",
    "data": {
        "lobbies": {
            "JH+": {
                "id": "nulla eiusmod",
                "name": "ad ullamco sunt ipsum proident",
                "playerCount": 26791585,
                "maxPlayerCount": -87375796,
                "mapName": "amet proident non elit",
                "engineVersion": "in nostrud",
                "gameVersion": "ullamco esse cillum enim",
                "currentBattle": null
            }
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UnixTime = number;

export interface LobbyListResetEvent {
    type: "event";
    messageId: string;
    commandId: "lobby/listReset";
    data: LobbyListResetEventData;
}
export interface LobbyListResetEventData {
    lobbies: {
        [k: string]: LobbyOverview;
    };
}
export interface LobbyOverview {
    id: string;
    name: string;
    playerCount: number;
    maxPlayerCount: number;
    mapName: string;
    engineVersion: string;
    gameVersion: string;
    currentBattle: {
        startedAt: UnixTime;
    } | null;
}
```
---

## ListUpdated

Sent by the server whenever some lobbies are added, removed or modified.

- Endpoint Type: **Event**
- Source: **Server**
- Target: **User**
- Required Scopes: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyListUpdatedEvent",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "event" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/listUpdated" },
        "data": {
            "title": "LobbyListUpdatedEventData",
            "type": "object",
            "properties": {
                "lobbies": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": {
                            "anyOf": [
                                {
                                    "type": "object",
                                    "properties": {
                                        "id": { "type": "string" },
                                        "name": { "type": "string" },
                                        "playerCount": { "type": "integer" },
                                        "maxPlayerCount": { "type": "integer" },
                                        "mapName": { "type": "string" },
                                        "engineVersion": { "type": "string" },
                                        "gameVersion": { "type": "string" },
                                        "currentBattle": {
                                            "anyOf": [
                                                {
                                                    "type": "object",
                                                    "properties": {
                                                        "startedAt": {
                                                            "$ref": "#/definitions/unixTime"
                                                        }
                                                    },
                                                    "required": ["startedAt"]
                                                },
                                                { "type": "null" }
                                            ]
                                        }
                                    },
                                    "required": ["id"]
                                },
                                { "type": "null" }
                            ]
                        }
                    }
                }
            },
            "required": ["lobbies"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "in dolore",
    "commandId": "lobby/listUpdated",
    "data": {
        "lobbies": {
            "^-S:": {
                "id": "incididunt consectetur dolor",
                "name": "ex sed anim",
                "playerCount": 7251906,
                "maxPlayerCount": -89825213,
                "mapName": "id pariatur tempor ullamco",
                "engineVersion": "magna",
                "currentBattle": null
            },
            "N <": {
                "id": "proident quis",
                "gameVersion": "adipisicing ipsum aute officia"
            }
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UnixTime = number;

export interface LobbyListUpdatedEvent {
    type: "event";
    messageId: string;
    commandId: "lobby/listUpdated";
    data: LobbyListUpdatedEventData;
}
export interface LobbyListUpdatedEventData {
    lobbies: {
        [k: string]: {
            id: string;
            name?: string;
            playerCount?: number;
            maxPlayerCount?: number;
            mapName?: string;
            engineVersion?: string;
            gameVersion?: string;
            currentBattle?: {
                startedAt: UnixTime;
            } | null;
        } | null;
    };
}
```
---

## Spectate

Move the client to the spectator queue. If already in spectator queue, has no effect (but still succeed).

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbySpectateRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/spectate" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "ut pariatur",
    "commandId": "lobby/spectate"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbySpectateRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/spectate";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbySpectateResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbySpectateOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/spectate" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbySpectateFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/spectate" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "not_in_lobby",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "mollit id",
    "commandId": "lobby/spectate",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbySpectateOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/spectate";
    status: "success";
}
```
Possible Failed Reasons: `not_in_lobby`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## StartBattle

Start the battle for the lobby. If this request succeed players will receive a battle/start request.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyStartBattleRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/startBattle" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "nisi ut ullamco sint",
    "commandId": "lobby/startBattle"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyStartBattleRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/startBattle";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyStartBattleResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyStartBattleOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/startBattle" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyStartBattleFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/startBattle" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "occaecat id in do nostrud",
    "commandId": "lobby/startBattle",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyStartBattleOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/startBattle";
    status: "success";
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## SubscribeList

Ask the server to send updates about lobby list. Idempotent, subscribing multiple time has no effect.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbySubscribeListRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/subscribeList" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "incididunt deserunt ullamco culpa nulla",
    "commandId": "lobby/subscribeList"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbySubscribeListRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/subscribeList";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbySubscribeListResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbySubscribeListOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/subscribeList" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbySubscribeListFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/subscribeList" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "non",
    "commandId": "lobby/subscribeList",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbySubscribeListOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/subscribeList";
    status: "success";
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## UnsubscribeList

Ask the server to stop sending updates about lobby list. Idempotent, if not subscribed, will still succeed.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUnsubscribeListRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/unsubscribeList" }
    },
    "required": ["type", "messageId", "commandId"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "Duis dolor esse",
    "commandId": "lobby/unsubscribeList"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUnsubscribeListRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/unsubscribeList";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUnsubscribeListResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyUnsubscribeListOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/unsubscribeList" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyUnsubscribeListFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/unsubscribeList" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "reprehenderit",
    "commandId": "lobby/unsubscribeList",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUnsubscribeListOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/unsubscribeList";
    status: "success";
}
```
Possible Failed Reasons: `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## UpdateMods

Update the mods for the lobby. Only the lobby boss can change mods. Order matters!

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUpdateModsRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/updateMods" },
        "data": {
            "title": "LobbyUpdateModsRequestData",
            "type": "object",
            "properties": {
                "lobbyId": { "type": "string" },
                "mods": {
                    "description": "Ordered list of mods. Later mods override earlier ones.",
                    "type": "array",
                    "items": { "$ref": "#/definitions/mod" },
                    "maxItems": 10
                }
            },
            "required": ["lobbyId", "mods"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "occaecat labore",
    "commandId": "lobby/updateMods",
    "data": {
        "lobbyId": "quis aliquip laborum dolor eiusmod",
        "mods": [
            {
                "name": "labore magna in id",
                "archiveName": "incididunt Lorem",
                "gitRef": "dolore",
                "repository": "dolor sed Ut tempor veniam",
                "type": "github"
            },
            {
                "name": "ut et irure Ut",
                "archiveName": "anim id esse Duis",
                "gitRef": "sunt",
                "repository": "consequat do laboris",
                "type": "github"
            },
            {
                "name": "reprehenderit mollit",
                "archiveName": "est mollit consectetur nisi",
                "gitRef": "eiusmod",
                "repository": "Excepteur quis",
                "type": "github"
            },
            {
                "name": "ullamco amet aute commodo nisi",
                "archiveName": "veniam",
                "gitRef": "nostrud do dolore consectetur",
                "repository": "dolor ipsum exercitation",
                "type": "github"
            },
            {
                "name": "nulla mollit",
                "archiveName": "ipsum in incididunt",
                "gitRef": "incididunt minim do deserunt",
                "repository": "sint",
                "type": "github"
            },
            {
                "name": "in veniam",
                "archiveName": "magna est non in ut",
                "gitRef": "consectetur",
                "repository": "aliqua cillum",
                "type": "github"
            },
            {
                "name": "ex elit in commodo",
                "archiveName": "Excepteur dolor",
                "gitRef": "aliqua",
                "repository": "mollit in ad in Ut",
                "type": "github"
            },
            {
                "name": "ex dolor nulla",
                "archiveName": "pariatur adipisicing officia sint",
                "gitRef": "elit",
                "repository": "in nisi veniam irure sit",
                "type": "github"
            },
            {
                "name": "dolore",
                "archiveName": "Lorem",
                "gitRef": "laboris culpa Excepteur",
                "repository": "ullamco nostrud",
                "type": "github"
            },
            {
                "name": "fugiat commodo ipsum do",
                "archiveName": "commodo aliquip nostrud ea",
                "gitRef": "incididunt dolor ex",
                "repository": "consequat ut",
                "type": "github"
            }
        ]
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUpdateModsRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/updateMods";
    data: LobbyUpdateModsRequestData;
}
export interface LobbyUpdateModsRequestData {
    lobbyId: string;
    mods:
        | []
        | [Mod]
        | [Mod, Mod]
        | [Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod];
}
export interface Mod {
    name: string;
    archiveName: string;
    gitRef: string;
    repository: string;
    type: "github";
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUpdateModsResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyUpdateModsOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/updateMods" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyUpdateModsFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/updateMods" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "insufficient_permissions",
                        "not_in_lobby",
                        "too_many_mods",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "in eiusmod aliqua",
    "commandId": "lobby/updateMods",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUpdateModsOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/updateMods";
    status: "success";
}
```
Possible Failed Reasons: `insufficient_permissions`, `not_in_lobby`, `too_many_mods`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## UpdateSync

Report the member's sync status - which resources they have downloaded and are ready to use.

- Endpoint Type: **Request** -> **Response**
- Source: **User**
- Target: **Server**
- Required Scopes: `tachyon.lobby`

### Request

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUpdateSyncRequest",
    "tachyon": {
        "source": "user",
        "target": "server",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "request" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/updateSync" },
        "data": {
            "title": "LobbyUpdateSyncRequestData",
            "type": "object",
            "properties": {
                "lobbyId": { "type": "string" },
                "sync": { "$ref": "#/definitions/memberSyncStatus" }
            },
            "required": ["lobbyId", "sync"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "request",
    "messageId": "dolore",
    "commandId": "lobby/updateSync",
    "data": {
        "lobbyId": "non do dolore",
        "sync": {
            "map": false,
            "engine": false,
            "game": false,
            "mods": [
                "nostrud",
                "aliquip proident ex",
                "officia sit non voluptate"
            ]
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUpdateSyncRequest {
    type: "request";
    messageId: string;
    commandId: "lobby/updateSync";
    data: LobbyUpdateSyncRequestData;
}
export interface LobbyUpdateSyncRequestData {
    lobbyId: string;
    sync: MemberSyncStatus;
}
export interface MemberSyncStatus {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
```
### Response

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUpdateSyncResponse",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "anyOf": [
        {
            "title": "LobbyUpdateSyncOkResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/updateSync" },
                "status": { "const": "success" }
            },
            "required": ["type", "messageId", "commandId", "status"]
        },
        {
            "title": "LobbyUpdateSyncFailResponse",
            "type": "object",
            "properties": {
                "type": { "const": "response" },
                "messageId": { "type": "string" },
                "commandId": { "const": "lobby/updateSync" },
                "status": { "const": "failed" },
                "reason": {
                    "enum": [
                        "not_in_lobby",
                        "internal_error",
                        "unauthorized",
                        "invalid_request",
                        "command_unimplemented"
                    ]
                },
                "details": { "type": "string" }
            },
            "required": ["type", "messageId", "commandId", "status", "reason"]
        }
    ]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "response",
    "messageId": "ipsum",
    "commandId": "lobby/updateSync",
    "status": "success"
}
```
</details>

#### TypeScript Definition
```ts
export interface LobbyUpdateSyncOkResponse {
    type: "response";
    messageId: string;
    commandId: "lobby/updateSync";
    status: "success";
}
```
Possible Failed Reasons: `not_in_lobby`, `internal_error`, `unauthorized`, `invalid_request`, `command_unimplemented`

---

## Updated

Sent by the server whenever something in the lobby changes. Uses json patch (RFC-7386)

- Endpoint Type: **Event**
- Source: **Server**
- Target: **User**
- Required Scopes: `tachyon.lobby`

### Event

<details>
<summary>JSONSchema</summary>

```json
{
    "title": "LobbyUpdatedEvent",
    "tachyon": {
        "source": "server",
        "target": "user",
        "scopes": ["tachyon.lobby"]
    },
    "type": "object",
    "properties": {
        "type": { "const": "event" },
        "messageId": { "type": "string" },
        "commandId": { "const": "lobby/updated" },
        "data": {
            "title": "LobbyUpdatedEventData",
            "type": "object",
            "properties": {
                "id": { "type": "string" },
                "bossId": { "$ref": "#/definitions/userId" },
                "name": { "type": "string" },
                "mapName": { "type": "string" },
                "engineVersion": { "type": "string" },
                "gameVersion": { "type": "string" },
                "mods": {
                    "description": "Ordered list of mods. Order matters - later mods override earlier ones.",
                    "type": "array",
                    "items": { "$ref": "#/definitions/mod" },
                    "maxItems": 10
                },
                "allyTeams": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": {
                            "anyOf": [
                                {
                                    "description": "this represent an array, items should be sorted lexicographically on their keys",
                                    "type": "object",
                                    "properties": {
                                        "startBox": {
                                            "$ref": "#/definitions/startBox"
                                        },
                                        "maxTeams": {
                                            "type": "integer",
                                            "minimum": 1
                                        },
                                        "teams": {
                                            "type": "object",
                                            "patternProperties": {
                                                "^(.*)$": {
                                                    "anyOf": [
                                                        {
                                                            "type": "object",
                                                            "properties": {
                                                                "maxPlayers": {
                                                                    "type": "integer",
                                                                    "minimum": 1
                                                                }
                                                            }
                                                        },
                                                        { "type": "null" }
                                                    ]
                                                }
                                            }
                                        }
                                    },
                                    "required": ["teams"]
                                },
                                { "type": "null" }
                            ]
                        }
                    }
                },
                "members": {
                    "type": "object",
                    "patternProperties": {
                        "^(.*)$": {
                            "anyOf": [
                                {
                                    "anyOf": [
                                        {
                                            "type": "object",
                                            "properties": {
                                                "type": { "const": "player" },
                                                "id": {
                                                    "$ref": "#/definitions/userId"
                                                },
                                                "allyTeam": {
                                                    "type": "string"
                                                },
                                                "team": { "type": "string" },
                                                "player": { "type": "string" },
                                                "sync": {
                                                    "$ref": "#/definitions/memberSyncStatus"
                                                }
                                            },
                                            "required": ["type", "id"]
                                        },
                                        {
                                            "type": "object",
                                            "properties": {
                                                "type": { "const": "spec" },
                                                "id": {
                                                    "$ref": "#/definitions/userId"
                                                },
                                                "joinQueuePosition": {
                                                    "anyOf": [
                                                        { "type": "number" },
                                                        { "type": "null" }
                                                    ]
                                                },
                                                "sync": {
                                                    "$ref": "#/definitions/memberSyncStatus"
                                                }
                                            },
                                            "required": ["type", "id"]
                                        }
                                    ]
                                },
                                { "type": "null" }
                            ]
                        }
                    }
                },
                "currentBattle": {
                    "anyOf": [
                        {
                            "description": "If a battle is currently happening, here are the info",
                            "type": "object",
                            "properties": {
                                "id": { "type": "string" },
                                "startedAt": {
                                    "$ref": "#/definitions/unixTime"
                                }
                            },
                            "required": ["id", "startedAt"]
                        },
                        { "type": "null" }
                    ]
                }
            },
            "required": ["id"]
        }
    },
    "required": ["type", "messageId", "commandId", "data"]
}

```
</details>

<details>
<summary>Example</summary>

```json
{
    "type": "event",
    "messageId": "laboris ipsum ea ut sit",
    "commandId": "lobby/updated",
    "data": {
        "id": "deserunt adipisicing enim tempor reprehenderit",
        "bossId": "351",
        "name": "aliquip culpa cillum mollit",
        "gameVersion": "eiusmod",
        "currentBattle": {
            "id": "sit minim consectetur",
            "startedAt": 1705432698000000
        }
    }
}
```
</details>

#### TypeScript Definition
```ts
export type UserId = string;
export type UnixTime = number;

export interface LobbyUpdatedEvent {
    type: "event";
    messageId: string;
    commandId: "lobby/updated";
    data: LobbyUpdatedEventData;
}
export interface LobbyUpdatedEventData {
    id: string;
    bossId?: UserId;
    name?: string;
    mapName?: string;
    engineVersion?: string;
    gameVersion?: string;
    mods?:
        | []
        | [Mod]
        | [Mod, Mod]
        | [Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod]
        | [Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod, Mod];
    allyTeams?: {
        [k: string]: {
            startBox?: StartBox;
            maxTeams?: number;
            teams: {
                [k: string]: {
                    maxPlayers?: number;
                } | null;
            };
        } | null;
    };
    members?: {
        [k: string]:
            | (
                  | {
                        type: "player";
                        id: UserId;
                        allyTeam?: string;
                        team?: string;
                        player?: string;
                        sync?: MemberSyncStatus;
                    }
                  | {
                        type: "spec";
                        id: UserId;
                        joinQueuePosition?: number | null;
                        sync?: MemberSyncStatus;
                    }
              )
            | null;
    };
    currentBattle?: {
        id: string;
        startedAt: UnixTime;
    } | null;
}
export interface Mod {
    name: string;
    archiveName: string;
    gitRef: string;
    repository: string;
    type: "github";
}
export interface StartBox {
    top: number;
    bottom: number;
    left: number;
    right: number;
}
export interface MemberSyncStatus {
    map: boolean;
    engine: boolean;
    game: boolean;
    mods: string[];
}
```
